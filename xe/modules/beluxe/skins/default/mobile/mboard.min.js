jQuery(function($){String.prototype.pidUcfirst=function(){var a=this;return a.charAt(0).toUpperCase()+a.slice(1)},$.fn.pidDeclareBtninit=function(){this.click(function(){var a,b=$(this),c=b.attr("data-type"),d=b.attr("data-srl"),e=b.attr("data-rec")||"0",f={target_srl:d,cur_mid:current_mid,mid:current_mid};return a=prompt(_DXS_MSGS_.declare,""),"string"!=typeof a?!1:a.trim()?(exec_json(c+".proc"+c.pidUcfirst()+"Declare",f,function(b){if(alert(b.message),0===b.error){if("0"==e)return location.reload()||!1;var c=(_DXS_MSGS_.declare_msg||"declare").replace(/%s/g,d),f=current_url.setQuery("comment_srl",d);a=a+'<br /><br /><a href="'+f+'">'+f+"</a>";var g={receiver_srl:e,title:c,content:a};exec_json("communication.procCommunicationSendMessage",g,function(a){alert(a.message),location.reload()})}}),!1):alert("Please enter the message.")||!1})},$.fn.pidVoteBtninit=function(){this.click(function(){var a=$(this),b=a.attr("href"),c=a.attr("data-type"),d=a.attr("data-srl"),e={target_srl:d,cur_mid:current_mid,mid:current_mid};return exec_json(c+".proc"+c.pidUcfirst()+("#recommend"==b?"VoteUp":"VoteDown"),e,function(c){if(alert(c.message),0===c.error){var d=a.find("em.cnt");d.text((parseInt(d.text())||0)+("#recommend"==b?1:-1))}}),!1})},pidLoadPage=function(a,b,c){if(!$("#clwm").length){var d='<div id="clwm" style="height:2px;overflow:hidden"><img src="../../../common/img/msg.loading.gif" style="width:100%" /></div>';$("#clpn").length?$("#clpn").before(d):$("#clst").after(d)}exec_json("beluxe.getBeluxeMobileCommentPage",{cpage:b,document_srl:a,clist_count:c,mid:current_mid},function(a){var b=$(a.html);$("#cl").remove(),$("#clpn").remove(),$("a.prev[data-page],a.next[data-page]",b).click(function(){var a=$(this).attr("data-srl"),b=$(this).attr("data-page"),c=$(this).attr("data-count");return pidLoadPage(a,b,c),!1}),$("a[href^=#][href$=recommend][data-type]",b).pidVoteBtninit(),$("a[href=#declare][data-type]",b).pidDeclareBtninit(),$("#clwm").remove(),$("#clst").after(b)})},$("a[href=#declare][data-type]").pidDeclareBtninit(),$("a[href^=#][href$=recommend][data-type]").pidVoteBtninit(),$("#xe_message:eq(0)").each(function(){alert($("p",this).text())}),$("#read:first").each(function(){var a=!1;$(".tgr[data-srl]").click(function(){if(!a){a=!0;var b=$(this).attr("data-srl"),c=$(this).attr("data-page"),d=$(this).attr("data-count");return pidLoadPage(b,c,d),!1}}),$(".co .mm").next().hide(),$(".mm").click(function(){return $(this).hide().next().show(),!1}),$(".tbn").click(function(){return $(this).next(".tgo").slideToggle("fast"),!1}),$(".tgr[data-load]").each(function(){$(this).click()})}),$("a[href=#categoryOpen]").click(function(){var a=$(".bd > .sd");return a.is(":hidden")?(a.width(0).show(),$(".bd > .st").animate({marginLeft:-250,marginRight:250},{step:function(a,b){$(".bd > .sd").width(a)}})):$(".bd > .st").animate({marginLeft:0,marginRight:0},{step:function(a,b){$(".bd > .sd").width(a)},complete:function(){a.hide()}}),!1}),$("li",".nav").each(function(){var a=$(".fr",this).width()||0;$("a",this).css("padding-right",a+10+"px")}),$("a[data-type]",".scSns").click(function(){var a,b,c,d=$("h2",".pn:eq(0)");switch(b=encodeURIComponent(d.text().trim()),c=encodeURIComponent(d.attr("title")),$(this).attr("data-type")){case"fa":a="http://www.facebook.com/share.php?t="+b+"&u="+c;break;case"de":a="http://www.delicious.com/save?v=5&noui&jump=close&url="+c+"&title="+b;break;default:a="http://twitter.com/home?status="+b+" "+c}return popopen(a,"_pop_sns"),!1}),$("a[data-slide]","#list").each(function(){$(this).on("before-open.mw",function(){var a=$(this).attr("data-slide")||0;isNaN(a)?alert(a):this.manualShow=!0}).on("after-open.mw",function(a,b){var d=this,e=$(this).attr("data-slide")||0;return e?void exec_json("file.getFileList",{mid:current_mid,editor_sequence:0,upload_target_srl:e},function(a){var e,f,g=a.files;if(0===a.error&&g&&g.length){for(d.imglist=[],e=0,c=g.length;e<c;e++)f=g[e].download_url,f.match(/\.(?:(jpe?g|png|gif|ico|bmp))$/i)&&(d.imglist[e]=f);b.list=d.imglist,b.index=0,b.xeShow()}}):!0}).pidSlideShow()}),$("#fUloader").is(function(){var fUfuncs={upBtn:$("#fUloader").find(".flc"),evalScripts:function(txt,identify){var ScriptFragment="<script[^>]*>([^]+?)</script>",matchAll=new RegExp(ScriptFragment,"img"),matchOne=new RegExp(ScriptFragment,"im"),extractScripts=(txt.match(matchAll)||[]).map(function(a){var b=(a.match(matchOne)||["",""])[1];return/^<\/?script>/i.test(b)?"":b});return eval(extractScripts.join(";")),eval(identify)},reLoadList:function(a){var b=document.getElementById("uploaderForm");exec_json("file.getFileList",{mid:current_mid,editor_sequence:"1",upload_target_srl:b.uploadTargetSrl.value||""},function(b){var c,d,e,f,g,h,i,j,k=0;if(i=b.files,j=$("#siFiles").empty(),$("#fUpreview").find(".fpv").empty().end().is(function(){i&&i.length?$(this).show():$(this).hide()}),i&&i.length){for(c=0,k=i.length;k>c;c++)h=i[c],g=h.source_filename,f=h.download_url,d=h.file_srl,e=parseInt(h.file_size),e=1024>e?e+"Byte":1048576>e?Math.round(e/1024*10)/10+"KB":Math.round(e/1048576*10)/10+"MB",$('<option value="'+d+'" data-src="'+f+'"></option>').appendTo(j).text(g+" ("+e+")").addClass(""!==f?"success":"error");void 0!==a&&a&&j.val(a),j.trigger("change")}fUfuncs.upBtn.text("File upload ("+k+")")})}},afOptions={beforeSend:function(){fUfuncs.upBtn.text("0%")},uploadProgress:function(a,b,c,d){fUfuncs.upBtn.text(d+"%")},success:function(){fUfuncs.upBtn.text("100%")},complete:function(a){var b,c=fUfuncs.evalScripts(a.responseText,"uploaded_fileinfo")||{};c.error<0?alert(c.message):(b=document.getElementById("siFf"),b.document_srl.value=c.upload_target_srl||"",b=document.getElementById("uploaderForm"),b.uploadTargetSrl.value=c.upload_target_srl||""),fUfuncs.upBtn.text("File upload (0)"),fUfuncs.reLoadList(c.file_srl)},error:function(){alert("ERROR: unable to upload files")}};$.fn.insertAtCaret=function(a){var b="undefined"!=typeof this[0].name?this[0]:this;if($.browser.msie)b.focus(),sel=document.selection.createRange(),sel.text=a,b.focus();else if($.browser.mozilla||$.browser.webkit){var c=b.selectionStart,d=b.selectionEnd,e=b.scrollTop;b.value=b.value.substring(0,c)+a+b.value.substring(d,b.value.length),b.focus(),b.selectionStart=c+a.length,b.selectionEnd=c+a.length,b.scrollTop=e}else b.value+=a,b.focus()},$("#uploaderForm").find("input[type=file]").on("change",function(){$(this).parent().trigger("submit")}).end().ajaxForm(afOptions),fUfuncs.upBtn.click(function(){return $("#uploaderForm").find("input[type=file]").trigger("click"),!1}),$("#fUpreview").is(function(){$(this).find(".scFcl").click(function(){var a=$("#siFiles").val();return a&&confirm("Do you want to delete a file?")&&exec_json("file.procFileDelete",{file_srls:a,editor_sequence:"1"},function(a){fUfuncs.reLoadList()}),!1}),$(this).find(".scFin").click(function(){var a,b=$("#siFiles");return b=[b.find("option[value="+b.val()+"]").text(),b.find("option[value="+b.val()+"]").attr("data-src")],b&&(a=b[1].match(/\.(?:(jpe?g|png|gif|ico))$/i)?'<img src="'+b[1]+'" />':'<a href="'+b[1]+'">'+b[0]+"</a>",$("textarea[name=content]","#siFf").insertAtCaret(a),$("input[name=use_html]","#siFf").attr("checked","checked")),!1}),$("#siFiles").change(function(){var a,b=$("#fUpreview").find(".fpv"),c=$(this),d=c.val();c=[c.find("option[value="+c.val()+"]").text(),c.find("option[value="+c.val()+"]").attr("data-src")],c[1].match(/\.(?:(jpe?g|png|gif|ico))$/i)?(a='<img src="'+c[1]+'" class="cover_image" />',b.addClass("is_image")):(a=c[1]?'<img src="./modules/editor/tpl/images/files.gif" />':'<img src="./common/img/blank.gif" />',b.removeClass("is_image")),$(a).click(function(){return b.is("[data-set-cover]")?("cover_image"===($(this).attr("class")||"")&&exec_json("file.procFileSetCoverImage",{file_srl:d,mid:current_mid,editor_sequence:"1"},function(a){0===a.error&&alert("set cover image")}),!1):!1}).appendTo(b.empty())})}),fUfuncs.reLoadList()})});