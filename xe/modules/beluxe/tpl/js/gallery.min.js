!function(a){var b={xScreen:a("<div>").attr("id","pid_gallery_screen").css({position:"fixed",display:"none",backgroundColor:"black",zIndex:500,opacity:.6}).appendTo(document.body),controls:a("<div>").attr("id","pid_gallery_controls").css({position:"fixed",display:"none",overflow:"hidden",zIndex:510}).appendTo(document.body),closebtn:a('<button type="button" id="pid_gallery_closebtn" />').css({top:"10px",backgroundPosition:"0 0"}),prevbtn:a('<button type="button" id="pid_gallery_prevbtn" />').css({left:"10px",backgroundPosition:"0 -64px"}).click(function(){b.xePrev()}),nextbtn:a('<button type="button" id="pid_gallery_nextbtn" />').attr("id","pid_gallery_nextbtn").css({right:"10px",backgroundPosition:"0 -128px"}).click(function(){b.xeNext()}),imgframe:a(new Image).attr("id","pid_gallery_holder").css({border:"5px solid white",zindex:520,maxWidth:"none",borderRadius:"5px",boxShadow:"0 0 10px #000"}),xeShow:function(){var b=(a(window).width(),a(window).height());a("#pid_gallery_controls,#pid_gallery_screen").show().css({top:0,right:0,bottom:0,left:0}),a("#pid_gallery_prevbtn,#pid_gallery_nextbtn").css("top",Math.round(b/2-32)+"px"),this.xeMove(0)},xeHide:function(a){this.xScreen.hide(),this.controls.hide()},xePrev:function(){this.xeMove(-1)},xeNext:function(){this.xeMove(1)},xeMove:function(b){var c=a(window).width(),d=a(window).height();this.index+=b,this.prevbtn.css("visibility",this.index>0?"visible":"hidden"),this.nextbtn.css("visibility",this.index<this.list.length-1?"visible":"hidden");var e=this.list[this.index];this.imgframe.attr("src",e).removeAttr("width").removeAttr("height"),this.imgframe.width()>0&&this.imgframe.css({left:c/2-this.imgframe.width()/2+"px",top:d/2-this.imgframe.height()/2+"px"}),this.closebtn.css({left:c/2-32+"px",top:"10px"}).focus()}};b.controls.append(b.closebtn,b.prevbtn,b.nextbtn).find(">button").css({position:"absolute",width:"64px",height:"64px",zIndex:530,cursor:"pointer",border:0,margin:0,padding:0,backgroundColor:"transparent",backgroundImage:"url("+request_uri+"addons/resize_image/btn.png)",backgroundRepeat:"no-repeat",opacity:".5",filter:"alpha(opacity=50)"}).mouseover(function(){a(this).css({opacity:"1",filter:"alpha(opacity=100)"})}).mouseout(function(){a(this).css({opacity:".5",filter:"alpha(opacity=50)"})}).focus(function(){a(this).trigger("mouseover")}).blur(function(){a(this).trigger("mouseout")}),b.imgframe.on("load",function(){var b=a(window).width(),c=a(window).height();a(this).css({left:b/2-a(this).width()/2+"px",top:c/2-a(this).height()/2+"px"})}).appendTo(b.controls).draggable(),a.fn.pidSlideShow=function(){this.click(function(){var b=a(this);return"showing"===b.data("state")&&b.trigger("close.mw"),b.trigger("open.mw"),!1}).on("open.mw",function(){var c=a(this);if(before_event=a.Event("before-open.mw"),c.trigger(before_event),before_event.isDefaultPrevented())return!1;if(!this.manualShow&&"object"!=typeof this.imglist)return!1;c.data("state","showing"),b.closebtn.click(function(){c.trigger("close.mw")}),this.manualShow?b.list=["./../common/img/msg.loading.gif"]:b.list=this.imglist,b.index=0,b.xeShow(),a(document).keydown(function(a){return 27==a.which?(c.trigger("close.mw"),!1):!0});var d=function(){c.trigger("after-open.mw",[b])};d()}).on("close.mw",function(){var c=a(this);if(before_event=a.Event("before-close.mw"),c.trigger(before_event),before_event.isDefaultPrevented())return!1;b.xeHide(),c.data("state","hiding");var d=function(){c.trigger("after-close.mw")};d()})}}(jQuery);